#!/usr/bin/env zsh
# Rust ê°œë°œ ë„êµ¬ ìë™ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ (ì„ íƒ ì‚¬í•­)

set -euo pipefail

echo "ğŸ› ï¸  Rust ê°œë°œ ë„êµ¬ ì„¤ì¹˜ ì‹œì‘..."
echo ""
echo "âš ï¸  ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë‹¤ìŒ ë„êµ¬ë“¤ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤:"
echo "  - cargo-nextest (ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ ëŸ¬ë„ˆ)"
echo "  - bacon (ì‹¤ì‹œê°„ ì»´íŒŒì¼ ê°ì‹œ)"
echo "  - cargo-watch (íŒŒì¼ ë³€ê²½ ê°ì§€)"
echo "  - cargo-audit (ë³´ì•ˆ ì·¨ì•½ì  ê²€ì‚¬)"
echo "  - cargo-deny (ì˜ì¡´ì„± ê²€ì¦)"
echo "  - cargo-tree (ì˜ì¡´ì„± íŠ¸ë¦¬)"
echo "  - cargo-outdated (ì—…ë°ì´íŠ¸ ì²´í¬)"
echo "  - cargo-expand (ë§¤í¬ë¡œ í™•ì¥)"
echo "  - cargo-bloat (ë°”ì´ë„ˆë¦¬ í¬ê¸° ë¶„ì„)"
echo ""

read -q "REPLY?ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n) "
echo ""

if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "âŒ ì„¤ì¹˜ ì·¨ì†Œë¨"
    exit 0
fi

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# í•„ìˆ˜ ë„êµ¬ (í…ŒìŠ¤íŠ¸ ë° ê°œë°œ)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

install_if_missing() {
    local tool=$1
    if command -v "$tool" &> /dev/null; then
        echo "â­ï¸  $tool: ì´ë¯¸ ì„¤ì¹˜ë¨"
    else
        echo "ğŸ“¦ $tool ì„¤ì¹˜ ì¤‘..."
        cargo install "$tool"
        echo "âœ… $tool ì„¤ì¹˜ ì™„ë£Œ"
    fi
}

echo ""
echo "ğŸ”§ í•„ìˆ˜ ë„êµ¬ ì„¤ì¹˜..."
install_if_missing "cargo-nextest"
install_if_missing "bacon"
install_if_missing "cargo-watch"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë³´ì•ˆ ë° í’ˆì§ˆ ë„êµ¬
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo ""
echo "ğŸ”’ ë³´ì•ˆ ë„êµ¬ ì„¤ì¹˜..."
install_if_missing "cargo-audit"
install_if_missing "cargo-deny"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë¶„ì„ ë„êµ¬
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo ""
echo "ğŸ“Š ë¶„ì„ ë„êµ¬ ì„¤ì¹˜..."
install_if_missing "cargo-tree"
install_if_missing "cargo-outdated"
install_if_missing "cargo-expand"
install_if_missing "cargo-bloat"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì™„ë£Œ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo ""
echo "âœ… ëª¨ë“  ë„êµ¬ ì„¤ì¹˜ ì™„ë£Œ!"
echo ""
echo "ğŸš€ ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ê°œë°œì„ ì‹œì‘í•˜ì„¸ìš”:"
echo "  just rust-check-all    # ë¹ ë¥¸ ì „ì²´ ê²€ì‚¬"
echo "  just rust-watch        # ì‹¤ì‹œê°„ ì»´íŒŒì¼"
echo "  bacon                  # ì‹¤ì‹œê°„ clippy + test"
echo ""
echo "ğŸ“š ë„êµ¬ ì‚¬ìš©ë²•:"
echo "  cargo nextest run      # ë¹ ë¥¸ í…ŒìŠ¤íŠ¸"
echo "  cargo audit            # ë³´ì•ˆ ì·¨ì•½ì  ê²€ì‚¬"
echo "  cargo outdated         # ì—…ë°ì´íŠ¸ ê°€ëŠ¥í•œ íŒ¨í‚¤ì§€"
echo "  cargo bloat --release  # ë°”ì´ë„ˆë¦¬ í¬ê¸° ë¶„ì„"
echo ""
