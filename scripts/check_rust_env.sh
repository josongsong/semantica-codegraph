#!/usr/bin/env zsh
# Rust í™˜ê²½ë³€ìˆ˜ ì¶©ëŒ ê²€ì‚¬ ë° í•´ê²° ê°€ì´ë“œ

set -euo pipefail

echo "ğŸ” Rust ë¹Œë“œ í™˜ê²½ ê²€ì‚¬ ì¤‘..."
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 1. RUSTC_WRAPPER ì¶©ëŒ ê²€ì‚¬
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if [[ -n "${RUSTC_WRAPPER:-}" ]]; then
    echo "âš ï¸  í™˜ê²½ë³€ìˆ˜ ì¶©ëŒ ë°œê²¬!"
    echo ""
    echo "í˜„ì¬ ì„¤ì •:"
    echo "  RUSTC_WRAPPER=$RUSTC_WRAPPER"
    echo ""
    echo "ë¬¸ì œ:"
    echo "  - .cargo/config.tomlì—ì„œ sccacheë¥¼ ë¹„í™œì„±í™”í•´ë„"
    echo "  - ì‰˜ í™˜ê²½ë³€ìˆ˜ê°€ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì ¸ ë¬´ì‹œë©ë‹ˆë‹¤"
    echo ""
    echo "í•´ê²° ë°©ë²•:"
    echo "  1. ~/.zshrc íŒŒì¼ì„ ì—½ë‹ˆë‹¤:"
    echo "     \$ vim ~/.zshrc"
    echo ""
    echo "  2. ë‹¤ìŒ ì¤„ì„ ì°¾ì•„ì„œ ì œê±°í•˜ê±°ë‚˜ ì£¼ì„ ì²˜ë¦¬:"
    echo "     export RUSTC_WRAPPER=sccache"
    echo "     # â†“ ì£¼ì„ ì²˜ë¦¬"
    echo "     # export RUSTC_WRAPPER=sccache"
    echo ""
    echo "  3. ì‰˜ ì¬ì‹œì‘:"
    echo "     \$ exec zsh"
    echo ""
    echo "  4. ë‹¤ì‹œ ê²€ì‚¬:"
    echo "     \$ ./scripts/check_rust_env.sh"
    echo ""
    exit 1
else
    echo "âœ… RUSTC_WRAPPER: ì¶©ëŒ ì—†ìŒ"
fi

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 2. Cargo ì„¤ì • í™•ì¸
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if [[ -f "$HOME/.cargo/config.toml" ]]; then
    echo "â„¹ï¸  ~/.cargo/config.toml ë°œê²¬"
    if grep -q "rustc-wrapper.*sccache" "$HOME/.cargo/config.toml" 2>/dev/null; then
        echo "âš ï¸  ê¸€ë¡œë²Œ Cargo ì„¤ì •ì—ì„œ sccache ë°œê²¬"
        echo "   í”„ë¡œì íŠ¸ë³„ ì„¤ì •(.cargo/config.toml)ì´ ìš°ì„ ë©ë‹ˆë‹¤"
    fi
else
    echo "âœ… ê¸€ë¡œë²Œ Cargo ì„¤ì •: ì—†ìŒ (OK)"
fi

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 3. Rust íˆ´ì²´ì¸ í™•ì¸
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo ""
echo "ğŸ“¦ Rust íˆ´ì²´ì¸ ì •ë³´:"
rustc --version
cargo --version

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 4. ë¹Œë“œ ìºì‹œ ìƒíƒœ í™•ì¸
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo ""
echo "ğŸ’¾ ë¹Œë“œ ìºì‹œ ìƒíƒœ:"

if command -v sccache &> /dev/null; then
    echo "  sccache: ì„¤ì¹˜ë¨"
    sccache --show-stats | head -5
else
    echo "  sccache: ë¯¸ì„¤ì¹˜"
fi

if [[ -d "$HOME/.cargo/.rustc_info.json" ]]; then
    echo "  Cargo cache: ì¡´ì¬"
else
    echo "  Cargo cache: ì—†ìŒ"
fi

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 5. ê¶Œì¥ ë„êµ¬ ì„¤ì¹˜ í™•ì¸
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo ""
echo "ğŸ› ï¸  ê¶Œì¥ ê°œë°œ ë„êµ¬ ì„¤ì¹˜ ìƒíƒœ:"

check_tool() {
    if command -v "$1" &> /dev/null; then
        echo "  âœ… $1"
    else
        echo "  âŒ $1 (ì„¤ì¹˜ ê¶Œì¥)"
    fi
}

check_tool "cargo-nextest"
check_tool "bacon"
check_tool "cargo-watch"
check_tool "cargo-audit"
check_tool "cargo-deny"
check_tool "cargo-tree"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ê²°ê³¼
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo ""
echo "âœ… ëª¨ë“  ê²€ì‚¬ ì™„ë£Œ!"
echo ""
echo "ë‹¤ìŒ ë‹¨ê³„:"
echo "  - í™˜ê²½ë³€ìˆ˜ ì¶©ëŒì´ ì—†ìœ¼ë©´ ë°”ë¡œ ë¹Œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤"
echo "  - ê¶Œì¥ ë„êµ¬ ì„¤ì¹˜: ./scripts/install_rust_tools.sh"
echo "  - ë¹Œë“œ ì‹œì‘: just rust-build"
echo ""
