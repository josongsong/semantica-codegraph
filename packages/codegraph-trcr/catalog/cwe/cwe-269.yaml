# CWE-269: Improper Privilege Management
#
# Contract-first CWE definition
# Reference: https://cwe.mitre.org/data/definitions/269.html

metadata:
  cwe_id: CWE-269
  name: "Improper Privilege Management"
  severity: high
  owasp: "A04:2021-Insecure Design"
  category: "Access Control"

  status: active
  version: "1.0.0"
  last_updated: "2025-12-20"

  mitre_abstraction: class
  likelihood_of_exploit: medium

  references:
    - https://cwe.mitre.org/data/definitions/269.html
    - https://owasp.org/Top10/A04_2021-Insecure_Design/

description: |
  The software does not properly assign, modify, track, or check privileges for
  an actor, creating an unintended sphere of control for that actor.

sources:
  - id: source.privilege.user_role
    description: "User role or privilege level"
    patterns:
      - attr: role
      - attr: privilege
      - attr: permission
      - attr: is_admin

sinks:
  - id: sink.privilege.escalation
    description: "Privilege escalation operations"
    patterns:
      - call: setuid
        args: [0]
      - call: os.setuid
        args: [0]
      - call: setgid
        args: [0]
      - call: os.setgid
        args: [0]

  - id: sink.privilege.assignment
    description: "Direct privilege assignment"
    patterns:
      - attr: is_admin = True
      - attr: role = "admin"

sanitizers:
  - id: barrier.privilege.check
    description: "Privilege verification"
    patterns:
      - check_permission()
      - verify_admin()
      - require_role()

policy:
  grammar:
    WHEN:
      tag: untrusted
    FLOWS:
      - id: sink.privilege.escalation
      - id: sink.privilege.assignment
    BLOCK:
      UNLESS:
        kind: sanitizer
        tag: privilege

validation:
  min_test_cases: 4
  min_precision: 0.85
  min_recall: 0.80

test_suite:
  directory: "test-suite/CWE269_Privilege_Management"
  cases:
    - bad_01.py
    - good_01.py
