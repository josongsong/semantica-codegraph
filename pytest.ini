# ========================================================================
# Pytest Configuration
# ========================================================================
# Semantica Codegraph Test Rules (SOTA)에 맞춘 설정
#
# 테스트 계층:
#   - Unit Tests: 빠른 실행, mock/fake 사용
#   - Integration Tests: container.py + 실제 DB
#   - Scenario Tests: Golden 파일 기반
# ========================================================================

[pytest]
# 테스트 검색 경로
testpaths = tests

# 파일 패턴
python_files = test_*.py

# 클래스 패턴
python_classes = Test*

# 함수 패턴
python_functions = test_*

# 마커 정의
markers =
    unit: Unit tests (fast, no external dependencies)
    integration: Integration tests (requires docker-compose.test.yml)
    scenario: Scenario/Golden tests (검색 품질 회귀 방지)
    slow: Slow tests
    skip_ci: Skip in CI environment

# 추가 옵션
addopts =
    -v
    --strict-markers
    --tb=short
    --cov=src
    --cov-report=term-missing
    --cov-report=html
    --cov-report=xml
    --cov-fail-under=30
    # Unit tests는 기본 실행
    -m "not integration and not scenario"

# Coverage 설정
[coverage:run]
source = src
omit =
    */tests/*
    */test_*.py
    */__pycache__/*
    */migrations/*

[coverage:report]
# Coverage 최소 기준
fail_under = 30
precision = 2
show_missing = True
skip_covered = False

# Coverage 제외 패턴
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
    @abstractmethod
    @abc.abstractmethod

[coverage:html]
directory = htmlcov

[coverage:xml]
output = coverage.xml
