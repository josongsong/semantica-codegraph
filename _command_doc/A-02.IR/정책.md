1. 증분 인덱싱 정책군 (Incremental Indexing Policies)
1-1. 변경 범위 기반 증분 인덱싱

정책명: Span Overlap Incremental Policy
핵심 규칙:

텍스트 diff → changed_ranges 계산

span이 겹치는 노드만 영향 대상으로 선정

영향 노드(parent 포함)만 AST→IR 재생성

전체 파일 재생성 금지

1-2. 심볼 안정성 유지

정책명: StableSymbolID Matching Policy
핵심 규칙:

diff 기준 = stable_symbol_id + content_hash

심볼 이동/이름 변경에도 stable_symbol_id 유지

content_hash 변할 때만 updated 판정

1-3. Node Diff 최소화

정책명: Partial Node Update Policy
핵심 규칙:

added / updated / deleted 3종만 산출

stable_symbol_id 기준으로 비교

파일 단위 full update 금지

full rebuild는 예외 조건에서만

1-4. Edge 재계산 최소화

정책명: Source-Scoped Edge Rebuild Policy
핵심 규칙:

Edge는 source_id 단위로만 재계산

deleted 노드: outgoing edges 즉시 삭제

added/updated 노드: outgoing edges만 재생성

reverse edges(called_by 등)는 역탐색으로 처리

1-5. 전체 파일 재인덱싱 폴백

정책명: Structural Fallback Policy
핵심 규칙:

다음 조건일 때 incremental → full rebuild 전환

변경 라인 > 파일의 30%

AST 파싱 에러

top-level 구조(Class/Function 정의 등) 변경

import 블록 대규모 변경

2. IRStore 운영 정책군 (IRStore Operation Policies)
2-1. Hotset 우선 업데이트

정책명: Hotset-First IRStore Update Policy
핵심 규칙:

증분 인덱싱 시 Hotset(IRStore 메모리)이 항상 우선

Cold 파일도 diff 대상이면 Hotset으로 승격

DB(Kuzu) 반영은 비동기 처리

2-2. 검색 인덱스 부분 업데이트

정책명: Selective Re-Indexing Policy
핵심 규칙:

Qdrant/BM25/vector 인덱스는

added / updated 만 재색인

deleted는 제거

파일 전체 chunk 재임베딩 금지

3. 스냅샷 관리 정책군 (Snapshot Lifecycle Policies)
3-1. WORKSPACE 스냅샷

정책명: WORKSPACE
핵심 규칙:

snapshot_id = workspace:<user>@<session> 단일 유지

DB upsert(덮어쓰기)

JSON 스냅샷 없음

아카이브 없음

실시간 개발/빠른 응답용

3-2. GIT_COMMIT 스냅샷

정책명: GIT_COMMIT
핵심 규칙:

snapshot_id = commit:<sha> 불변

DB sync 저장

JSON 스냅샷 생성

아카이브(Optional)

재현성/회귀 테스트 기준점

3-3. BRANCH_MAIN 스냅샷

정책명: BRANCH_MAIN
핵심 규칙:

snapshot_id = branch:main@<sha> 불변

DB sync 저장

JSON 스냅샷 생성

S3 등 외부 아카이브

정식 배포/레퍼런스 스냅샷 기준
