# Chunk Layer êµ¬í˜„ ê³„íš (ìµœì¢…)

## ğŸ“‹ ë¬¸ì„œ ê°œìš”

**ëª©ì **: "ì‘ì—…ê³„íš" ë¬¸ì„œì™€ í˜„ì¬ êµ¬í˜„ ìƒíƒœë¥¼ ê¸°ë°˜ìœ¼ë¡œ, Chunk Layerì˜ ì™„ë£Œ ë° í™•ì¥ ê³„íšì„ ì •ë¦¬

**ì°¸ì¡° ë¬¸ì„œ**:
- [ì‘ì—…ê³„íš](ì‘ì—…ê³„íš) - ì „ì²´ ì‹¤í–‰ ê³„íšì„œ
- [ìŠ¤í‚¤ë§ˆëŒ€ì‘](ìŠ¤í‚¤ë§ˆëŒ€ì‘) - DB ìŠ¤í‚¤ë§ˆ ì„¤ê³„
- [IMPLEMENTATION_STATUS.md](../../IMPLEMENTATION_STATUS.md) - ì „ì²´ êµ¬í˜„ ìƒíƒœ

**ì‘ì„±ì¼**: 2024-11-24

---

## 1. ì „ì²´ ì•„í‚¤í…ì²˜ ìš”ì•½

### 1.1 Chunk Layerì˜ ì—­í• 

**í•µì‹¬ ëª©í‘œ**: Tree-sitter/IR/Graph ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Symbol-first 6ë‹¨ê³„ Chunk ê³„ì¸µ ìƒì„±

```
Repo â†’ Project â†’ Module â†’ File â†’ Class â†’ Function(Leaf)
```

**ì£¼ìš” ê¸°ëŠ¥**:
1. **ê³„ì¸µ ìƒì„±**: 6ë‹¨ê³„ ê³„ì¸µ êµ¬ì¡° ìƒì„±
2. **ì•ˆì •ì ì¸ ID**: FQN ê¸°ë°˜ chunk_id (stable_symbol_id)
3. **ì¦ë¶„ ê°±ì‹ **: íŒŒì¼ ì¶”ê°€/ì‚­ì œ/ìˆ˜ì •, rename/span drift ì²˜ë¦¬
4. **IR/Graph ë§¤í•‘**: Chunk â†” IRNode, Chunk â†” GraphNode
5. **ìƒìœ„ ë ˆì´ì–´ ì§€ì›**: RepoMap/Index/Retrieverê°€ ì‚¬ìš©í•  "LLM ì¹œí™”ì  ì½”ë“œ ë‹¨ìœ„"

### 1.2 ì•„í‚¤í…ì²˜ì—ì„œ ìœ„ì¹˜

```
src/foundation/parsing â†’ AST
src/foundation/ir â†’ IR v4
src/foundation/graph â†’ GraphDocument (Kuzu)
src/foundation/chunk â†’ Chunk Layer (ë³¸ ë¬¸ì„œ)
â”œâ”€â”€ models.py            # Chunk ëª¨ë¸
â”œâ”€â”€ id_generator.py      # FQN ê¸°ë°˜ ID ìƒì„±
â”œâ”€â”€ builder.py           # 6ë‹¨ê³„ ê³„ì¸µ ë¹Œë”
â”œâ”€â”€ boundary.py          # Boundary ê²€ì¦
â”œâ”€â”€ mapping.py           # IR/Graph ë§¤í•‘
â”œâ”€â”€ incremental.py       # ì¦ë¶„ ì—…ë°ì´íŠ¸
â””â”€â”€ store.py             # ChunkStore (Postgres)

src/repomap â†’ Chunk ê³„ì¸µ ìœ„ í”„ë¡œì íŠ¸ ì§€ë„
src/index â†’ Chunk ê¸°ë°˜ IndexDocument ìƒì„±
src/retriever â†’ Chunk/RepoMap/Index ì†Œë¹„
```

---

## 2. í˜„ì¬ êµ¬í˜„ ìƒíƒœ (2024-11-24 ê¸°ì¤€)

### âœ… ì™„ë£Œëœ í•­ëª© (Phase A/B ì™„ë£Œ)

#### 2.1 Core ëª¨ë¸ ë° ID ìƒì„±
- **Chunk ëª¨ë¸** ([src/foundation/chunk/models.py](../../src/foundation/chunk/models.py))
  - 6ë‹¨ê³„ ê³„ì¸µ (repo/project/module/file/class/function)
  - í™•ì¥ íƒ€ì… (route/service/repository/config/job/middleware)
  - Span tracking (start_line, end_line, original_start_line, original_end_line)
  - Version & commit tracking
  - ChunkRefreshResult ëª¨ë¸

- **ChunkIdGenerator** ([src/foundation/chunk/id_generator.py](../../src/foundation/chunk/id_generator.py))
  - FQN ê¸°ë°˜ ID ìƒì„±: `chunk:{repo_id}:{kind}:{fqn}`
  - ì¶©ëŒ ì‹œ content_hash suffix ì¶”ê°€

#### 2.2 ê³„ì¸µ ë¹Œë”
- **ChunkBuilder** ([src/foundation/chunk/builder.py](../../src/foundation/chunk/builder.py))
  - âœ… 6ë‹¨ê³„ ê³„ì¸µ ìƒì„±
    - `_build_repo_chunk`
    - `_build_project_chunks`
    - `_build_module_chunks`
    - `_build_file_chunks`
    - `_build_class_chunks`
    - `_build_function_chunks`
  - âœ… í™•ì¥ íƒ€ì… ìƒì„±
    - `_build_extended_chunks` (route/service/repository ë“±)
  - âœ… IR/Graph ë§¤í•‘ í†µí•©
  - âœ… Boundary ê²€ì¦

#### 2.3 Boundary ê²€ì¦
- **ChunkBoundaryValidator** ([src/foundation/chunk/boundary.py](../../src/foundation/chunk/boundary.py))
  - âœ… Sibling gap/overlap ê²€ì¶œ
  - âœ… Invalid range ê²€ì¶œ
  - âœ… Large class detection (í† í° ê¸°ì¤€)

#### 2.4 IR/Graph ë§¤í•‘
- **ChunkMapper** ([src/foundation/chunk/mapping.py](../../src/foundation/chunk/mapping.py))
  - âœ… Chunk â†’ IRNode ë§¤í•‘ (ë¼ì¸ ë²”ìœ„ ê¸°ë°˜)
  - âœ… ChunkToIR ìƒì„±

- **ChunkGraphMapper** ([src/foundation/chunk/mapping.py](../../src/foundation/chunk/mapping.py))
  - âœ… Leaf chunk: symbol 1:1 ë§¤í•‘
  - âœ… ìƒìœ„ chunk: í•˜ìœ„ chunk ì§‘ê³„
  - âœ… GraphNodeFilter (function/class/methodë§Œ í¬í•¨)
  - âœ… ChunkToGraph ìƒì„±

#### 2.5 ì¦ë¶„ ì—…ë°ì´íŠ¸ (Phase A & B)
- **ChunkIncrementalRefresher** ([src/foundation/chunk/incremental.py](../../src/foundation/chunk/incremental.py))
  - âœ… **Phase A (ê¸°ë³¸ ì¦ë¶„)** - ì™„ë£Œ
    - íŒŒì¼ ì¶”ê°€/ì‚­ì œ/ìˆ˜ì • ì²˜ë¦¬
    - content_hash ê¸°ë°˜ ìŠ¤í‚µ ìµœì í™”
    - Soft delete (is_deleted í”Œë˜ê·¸)
    - ChunkRefreshResult ì¶”ì 

  - âœ… **Phase B (Span Drift & Rename)** - ì™„ë£Œ
    - Span drift tracking (SPAN_DRIFT_THRESHOLD = 10)
    - original_start_line/original_end_line ìœ ì§€
    - Chunk-level rename detection (FQN ë³€ê²½ + content ë™ì¼)
    - ChunkUpdateHook Protocol
      - `on_chunk_modified(chunk)`
      - `on_chunk_drifted(chunk)`
      - `on_chunk_renamed(old_id, new_chunk)`

  - ğŸ”„ **Phase C (Diff-based Partial Updates)** - ì§„í–‰ ì¤‘
    - âœ… DiffHunk ëª¨ë¸
    - âœ… DiffParser (unified diff íŒŒì‹±)
    - â³ ChunkIncrementalRefresherì™€ í†µí•© (use_partial_updates)
    - â³ `_handle_modified_file_partial()` ì™„ì„±
    - â³ `_identify_affected_chunks()` êµ¬í˜„

#### 2.6 ChunkStore
- **ChunkStore Protocol** ([src/foundation/chunk/store.py](../../src/foundation/chunk/store.py))
  - âœ… ì¸í„°í˜ì´ìŠ¤ ì •ì˜
    - `save_chunk(chunk)`
    - `get_chunk(chunk_id)`
    - `find_chunks_by_repo(repo_id, snapshot_id)`
    - `find_chunk_by_file_and_line(repo_id, file_path, line)` - Zoekt ë§¤í•‘ìš©
    - `find_file_chunk(repo_id, file_path)` - Fallbackìš©
    - `delete_chunks_by_repo(repo_id, snapshot_id)`

- **InMemoryChunkStore** ([src/foundation/chunk/store.py](../../src/foundation/chunk/store.py))
  - âœ… In-memory êµ¬í˜„ (í…ŒìŠ¤íŠ¸/ê°œë°œìš©)
  - âœ… file_index ì¸ë±ìŠ¤ (file+line â†’ Chunk ë§¤í•‘ ìµœì í™”)
  - âœ… ìš°ì„ ìˆœìœ„ ì •ë ¬ (function > class > file)

- **PostgresChunkStore** ([src/foundation/chunk/store.py](../../src/foundation/chunk/store.py))
  - â³ ì¸í„°í˜ì´ìŠ¤ë§Œ ì •ì˜, ì‹¤ì œ êµ¬í˜„ ì—†ìŒ
  - â³ asyncpg ì—°ë™ í•„ìš”
  - â³ SQL ì¿¼ë¦¬ êµ¬í˜„ í•„ìš”

#### 2.7 í…ŒìŠ¤íŠ¸
- âœ… **test_chunk_models.py** - Chunk ëª¨ë¸ ê¸°ë³¸ í…ŒìŠ¤íŠ¸
- âœ… **test_chunk_boundary.py** - Boundary ê²€ì¦ í…ŒìŠ¤íŠ¸
- âœ… **test_chunk_builder.py** - ChunkBuilder í…ŒìŠ¤íŠ¸
- âœ… **test_chunk_mapping.py** - IR/Graph ë§¤í•‘ í…ŒìŠ¤íŠ¸
- âœ… **test_chunk_incremental.py** - ì¦ë¶„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸
- âœ… **test_chunk_partial_updates.py** - Phase C í…ŒìŠ¤íŠ¸ (ë¶€ë¶„)
- âœ… **test_chunk_graph_integration.py** - Graph í†µí•© í…ŒìŠ¤íŠ¸

### âŒ ë¯¸ì™„ë£Œ í•­ëª©

1. **Phase C ì™„ì„±** (Diff-based Partial Updates)
   - DiffParserëŠ” ì™„ì„±ë˜ì—ˆì§€ë§Œ ChunkIncrementalRefresherì™€ í†µí•© í•„ìš”
   - use_partial_updates í”Œë˜ê·¸ ë™ì‘ ì™„ì„±
   - _identify_affected_chunks() êµ¬í˜„

2. **PostgresChunkStore ì‹¤ì œ êµ¬í˜„**
   - asyncpg ì—°ë™
   - CRUD ì¿¼ë¦¬ êµ¬í˜„
   - find_chunk_by_file_and_line SQL êµ¬í˜„
   - íŠ¸ëœì­ì…˜ ê´€ë¦¬

3. **DB Migration ìŠ¤í¬ë¦½íŠ¸**
   - chunks í…Œì´ë¸”
   - chunk_hierarchy í…Œì´ë¸”
   - chunk_ir_map í…Œì´ë¸”
   - chunk_graph_map í…Œì´ë¸”
   - ì¸ë±ìŠ¤ ìƒì„±

4. **Extended Chunk Types ë¹Œë” ë¡œì§**
   - route, service, repository ë“± ì‹¤ì œ íƒì§€ ë¡œì§
   - Frameworkë³„ íŒ¨í„´ ì¸ì‹ (Django, FastAPI, NestJS ë“±)

5. **Snapshot ë²„ì „ ê´€ë¦¬**
   - snapshot_id ê¸°ë°˜ ë©€í‹° ë²„ì „ ì €ì¥
   - ê³¼ê±° snapshot ì¡°íšŒ ê¸°ëŠ¥

---

## 3. DB ìŠ¤í‚¤ë§ˆ (ìµœì¢…)

### 3.1 chunks í…Œì´ë¸”

```sql
CREATE TABLE chunks (
  chunk_id            TEXT PRIMARY KEY,        -- chunk:{repo_id}:{kind}:{fqn}...
  repo_id             TEXT NOT NULL,
  snapshot_id         TEXT NOT NULL,           -- Git commit hash ë“±
  project_id          TEXT,
  module_path         TEXT,
  file_path           TEXT,

  kind                TEXT NOT NULL,           -- repo | project | module | file | class | function | route | service | repository | config | job | middleware
  fqn                 TEXT NOT NULL,

  start_line          INTEGER,
  end_line            INTEGER,
  original_start_line INTEGER,
  original_end_line   INTEGER,

  content_hash        TEXT,

  parent_id           TEXT REFERENCES chunks(chunk_id),
  language            TEXT,
  symbol_visibility   TEXT,                    -- public | internal | private

  symbol_id           TEXT,                    -- GraphNodeId
  symbol_owner_id     TEXT,

  summary             TEXT,
  importance          DOUBLE PRECISION,

  attrs               JSONB DEFAULT '{}'::jsonb,

  -- ì¦ë¶„/ë²„ì €ë‹
  version             INTEGER NOT NULL DEFAULT 1,
  last_indexed_commit TEXT,
  is_deleted          BOOLEAN NOT NULL DEFAULT FALSE,

  -- ë©”íƒ€
  created_at          TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at          TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_chunks_repo_snapshot
  ON chunks(repo_id, snapshot_id);

CREATE INDEX idx_chunks_file_span
  ON chunks(repo_id, file_path, start_line, end_line)
  WHERE start_line IS NOT NULL AND end_line IS NOT NULL;

CREATE INDEX idx_chunks_repo_kind_fqn
  ON chunks(repo_id, kind, fqn);

CREATE INDEX idx_chunks_parent
  ON chunks(parent_id);

CREATE INDEX idx_chunks_symbol
  ON chunks(symbol_id)
  WHERE symbol_id IS NOT NULL;

-- LLM ê²€ìƒ‰ìš© (optional but recommended)
ALTER TABLE chunks
  ADD COLUMN search_text TEXT;

CREATE INDEX idx_chunks_search_text_gin
  ON chunks
  USING gin (to_tsvector('simple', search_text));
```

### 3.2 chunk_hierarchy í…Œì´ë¸”

```sql
CREATE TABLE chunk_hierarchy (
  parent_chunk_id  TEXT NOT NULL REFERENCES chunks(chunk_id) ON DELETE CASCADE,
  child_chunk_id   TEXT NOT NULL REFERENCES chunks(chunk_id) ON DELETE CASCADE,
  depth            INTEGER NOT NULL,
  position         INTEGER NOT NULL,
  PRIMARY KEY (parent_chunk_id, child_chunk_id)
);

CREATE INDEX idx_chunk_hierarchy_child
  ON chunk_hierarchy(child_chunk_id);
```

### 3.3 chunk_ir_map í…Œì´ë¸”

```sql
CREATE TABLE chunk_ir_map (
  chunk_id   TEXT NOT NULL REFERENCES chunks(chunk_id) ON DELETE CASCADE,
  ir_node_id TEXT NOT NULL,
  PRIMARY KEY (chunk_id, ir_node_id)
);

CREATE INDEX idx_chunk_ir_map_ir
  ON chunk_ir_map(ir_node_id);
```

### 3.4 chunk_graph_map í…Œì´ë¸”

```sql
CREATE TABLE chunk_graph_map (
  chunk_id      TEXT NOT NULL REFERENCES chunks(chunk_id) ON DELETE CASCADE,
  graph_node_id TEXT NOT NULL,                            -- Kuzu graph_node.node_id
  PRIMARY KEY (chunk_id, graph_node_id)
);

CREATE INDEX idx_chunk_graph_map_graph
  ON chunk_graph_map(graph_node_id);
```

---

## 4. êµ¬í˜„ ìš°ì„ ìˆœìœ„ ë° ë‹¨ê³„ë³„ ê³„íš

### Phase D: Production Ready (2ì£¼)

**ëª©í‘œ**: PostgresChunkStore êµ¬í˜„ + Phase C ì™„ì„± + DB Migration

#### Week 1: PostgresChunkStore & Migration (5ì¼)

**Day 1-2: DB Migration ìŠ¤í¬ë¦½íŠ¸**

```python
# migrations/002_create_chunk_tables.sql
-- ìœ„ì˜ ìŠ¤í‚¤ë§ˆ ì°¸ì¡°

# migrations/002_create_chunk_tables.py (Alembic)
"""create chunk tables

Revision ID: 002
Revises: 001
Create Date: 2024-11-24

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

def upgrade():
    # chunks í…Œì´ë¸” ìƒì„±
    op.create_table(
        'chunks',
        sa.Column('chunk_id', sa.Text(), nullable=False),
        sa.Column('repo_id', sa.Text(), nullable=False),
        sa.Column('snapshot_id', sa.Text(), nullable=False),
        # ... (ìœ„ ìŠ¤í‚¤ë§ˆ ì°¸ì¡°)
        sa.PrimaryKeyConstraint('chunk_id')
    )

    # ì¸ë±ìŠ¤ ìƒì„±
    op.create_index('idx_chunks_repo_snapshot', 'chunks', ['repo_id', 'snapshot_id'])
    op.create_index('idx_chunks_file_span', 'chunks', ['repo_id', 'file_path', 'start_line', 'end_line'])
    # ...

    # chunk_hierarchy, chunk_ir_map, chunk_graph_map í…Œì´ë¸” ìƒì„±
    # ...

def downgrade():
    op.drop_table('chunk_graph_map')
    op.drop_table('chunk_ir_map')
    op.drop_table('chunk_hierarchy')
    op.drop_table('chunks')
```

**Day 3-5: PostgresChunkStore êµ¬í˜„**

```python
# src/foundation/chunk/store.py

import asyncpg
from typing import Any

class PostgresChunkStore:
    """PostgreSQL ê¸°ë°˜ ChunkStore êµ¬í˜„"""

    def __init__(self, pool: asyncpg.Pool):
        self.pool = pool

    async def save_chunk(self, chunk: Chunk) -> None:
        """Chunk ì €ì¥ (upsert)"""
        async with self.pool.acquire() as conn:
            await conn.execute(
                """
                INSERT INTO chunks (
                    chunk_id, repo_id, snapshot_id, project_id, module_path, file_path,
                    kind, fqn, start_line, end_line, original_start_line, original_end_line,
                    content_hash, parent_id, language, symbol_visibility,
                    symbol_id, symbol_owner_id, summary, importance, attrs,
                    version, last_indexed_commit, is_deleted
                ) VALUES (
                    $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12,
                    $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24
                )
                ON CONFLICT (chunk_id) DO UPDATE SET
                    snapshot_id = EXCLUDED.snapshot_id,
                    start_line = EXCLUDED.start_line,
                    end_line = EXCLUDED.end_line,
                    original_start_line = EXCLUDED.original_start_line,
                    original_end_line = EXCLUDED.original_end_line,
                    content_hash = EXCLUDED.content_hash,
                    summary = EXCLUDED.summary,
                    importance = EXCLUDED.importance,
                    attrs = EXCLUDED.attrs,
                    version = EXCLUDED.version,
                    last_indexed_commit = EXCLUDED.last_indexed_commit,
                    is_deleted = EXCLUDED.is_deleted,
                    updated_at = NOW()
                """,
                chunk.chunk_id, chunk.repo_id, chunk.snapshot_id, # ...
            )

    async def get_chunk(self, chunk_id: str) -> Chunk | None:
        """Chunk IDë¡œ ì¡°íšŒ"""
        async with self.pool.acquire() as conn:
            row = await conn.fetchrow(
                "SELECT * FROM chunks WHERE chunk_id = $1",
                chunk_id
            )
            if not row:
                return None
            return self._row_to_chunk(row)

    async def find_chunks_by_repo(
        self, repo_id: str, snapshot_id: str | None = None
    ) -> list[Chunk]:
        """Repositoryì˜ ëª¨ë“  Chunk ì¡°íšŒ"""
        async with self.pool.acquire() as conn:
            if snapshot_id:
                rows = await conn.fetch(
                    """
                    SELECT * FROM chunks
                    WHERE repo_id = $1 AND snapshot_id = $2
                    ORDER BY kind, fqn
                    """,
                    repo_id, snapshot_id
                )
            else:
                rows = await conn.fetch(
                    """
                    SELECT * FROM chunks
                    WHERE repo_id = $1
                    ORDER BY kind, fqn
                    """,
                    repo_id
                )
            return [self._row_to_chunk(row) for row in rows]

    async def find_chunk_by_file_and_line(
        self,
        repo_id: str,
        file_path: str,
        line: int,
    ) -> Chunk | None:
        """
        Zoekt ê²°ê³¼(file+line)ë¥¼ Chunkë¡œ ë§¤í•‘.

        ìš°ì„ ìˆœìœ„: function > class > file
        """
        async with self.pool.acquire() as conn:
            row = await conn.fetchrow(
                """
                SELECT *
                FROM chunks
                WHERE repo_id = $1
                  AND file_path = $2
                  AND start_line <= $3
                  AND end_line >= $3
                  AND is_deleted = FALSE
                ORDER BY
                  CASE kind
                    WHEN 'function' THEN 1
                    WHEN 'method' THEN 1
                    WHEN 'class' THEN 2
                    WHEN 'file' THEN 3
                    ELSE 4
                  END,
                  (end_line - start_line) ASC
                LIMIT 1
                """,
                repo_id, file_path, line
            )
            if not row:
                return None
            return self._row_to_chunk(row)

    async def find_file_chunk(self, repo_id: str, file_path: str) -> Chunk | None:
        """íŒŒì¼ ë ˆë²¨ Chunk ì¡°íšŒ (fallbackìš©)"""
        async with self.pool.acquire() as conn:
            row = await conn.fetchrow(
                """
                SELECT * FROM chunks
                WHERE repo_id = $1
                  AND file_path = $2
                  AND kind = 'file'
                  AND is_deleted = FALSE
                LIMIT 1
                """,
                repo_id, file_path
            )
            if not row:
                return None
            return self._row_to_chunk(row)

    async def delete_chunks_by_repo(self, repo_id: str, snapshot_id: str) -> None:
        """Repositoryì˜ ëª¨ë“  Chunk ì‚­ì œ (soft delete)"""
        async with self.pool.acquire() as conn:
            await conn.execute(
                """
                UPDATE chunks
                SET is_deleted = TRUE, updated_at = NOW()
                WHERE repo_id = $1 AND snapshot_id = $2
                """,
                repo_id, snapshot_id
            )

    def _row_to_chunk(self, row: asyncpg.Record) -> Chunk:
        """DB row â†’ Chunk ë³€í™˜"""
        return Chunk(
            chunk_id=row['chunk_id'],
            repo_id=row['repo_id'],
            project_id=row['project_id'],
            module_path=row['module_path'],
            file_path=row['file_path'],
            kind=row['kind'],
            fqn=row['fqn'],
            start_line=row['start_line'],
            end_line=row['end_line'],
            original_start_line=row['original_start_line'],
            original_end_line=row['original_end_line'],
            content_hash=row['content_hash'],
            parent_id=row['parent_id'],
            children=[],  # ë³„ë„ ì¿¼ë¦¬ë¡œ ì±„ì›€
            language=row['language'],
            symbol_visibility=row['symbol_visibility'],
            symbol_id=row['symbol_id'],
            symbol_owner_id=row['symbol_owner_id'],
            summary=row['summary'],
            importance=row['importance'],
            attrs=row['attrs'] or {},
            version=row['version'],
            last_indexed_commit=row['last_indexed_commit'],
            is_deleted=row['is_deleted'],
        )
```

#### Week 2: Phase C ì™„ì„± & í†µí•© í…ŒìŠ¤íŠ¸ (5ì¼)

**Day 1-3: Phase C ì™„ì„±**

```python
# src/foundation/chunk/incremental.py

class ChunkIncrementalRefresher:
    # ...

    def _handle_modified_file_partial(
        self,
        file_path: str,
        diff_hunks: list[DiffHunk],
        old_chunks: list[Chunk],
        ir_doc: IRDocument,
        graph_doc: GraphDocument,
        file_text: list[str],
    ) -> None:
        """
        Phase C: Diff hunk ê¸°ë°˜ ë¶€ë¶„ ì—…ë°ì´íŠ¸.

        1. ì˜í–¥ë°›ì€ chunk ì‹ë³„ (span overlap)
        2. ì˜í–¥ë°›ì€ chunkë§Œ ì¬ìƒì„±
        3. ë‚˜ë¨¸ì§€ëŠ” ê¸°ì¡´ chunk ìœ ì§€
        """
        # 1. ì˜í–¥ë°›ì€ chunk ì‹ë³„
        affected_chunk_ids = self._identify_affected_chunks(diff_hunks, old_chunks)

        if not affected_chunk_ids:
            # Fallback: full rebuild
            logger.warning(f"No affected chunks found for {file_path}, falling back to full rebuild")
            self._handle_modified_file_full(file_path, old_chunks, ir_doc, graph_doc, file_text)
            return

        # 2. ì˜í–¥ë°›ì€ chunkë§Œ ì¬ìƒì„±
        new_chunks = self._builder.build(
            repo_id=self._repo_id,
            ir_doc=ir_doc,
            graph_doc=graph_doc,
            file_text=file_text,
            repo_config=self._repo_config,
        )[0]

        # 3. ì˜í–¥ë°›ì§€ ì•Šì€ chunkëŠ” ê¸°ì¡´ ìœ ì§€
        unaffected_chunks = [
            c for c in old_chunks
            if c.chunk_id not in affected_chunk_ids
        ]

        # 4. ë³‘í•©
        all_chunks = unaffected_chunks + new_chunks

        # 5. Diff ì ìš©
        for chunk in new_chunks:
            self._apply_chunk_diff(chunk, old_chunks)

    def _identify_affected_chunks(
        self,
        diff_hunks: list[DiffHunk],
        old_chunks: list[Chunk],
    ) -> set[str]:
        """
        Diff hunkì™€ ê²¹ì¹˜ëŠ” chunk ID ì‹ë³„.

        Hunkì˜ new_rangeì™€ chunkì˜ start_line/end_lineì„ ë¹„êµ.
        """
        affected_ids: set[str] = set()

        for hunk in diff_hunks:
            new_start, new_end = hunk.affected_new_range()

            for chunk in old_chunks:
                if chunk.start_line is None or chunk.end_line is None:
                    continue

                # Overlap ì²´í¬
                if not (new_end < chunk.start_line or new_start > chunk.end_line):
                    affected_ids.add(chunk.chunk_id)

        return affected_ids
```

**Day 4-5: í†µí•© í…ŒìŠ¤íŠ¸ & ë¬¸ì„œí™”**

- PostgresChunkStore í†µí•© í…ŒìŠ¤íŠ¸
- Phase C end-to-end í…ŒìŠ¤íŠ¸
- ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ (ëŒ€í˜• íŒŒì¼, ë‹¤ì¤‘ íŒŒì¼ ì¦ë¶„)
- API ë¬¸ì„œ ì •ë¦¬

### Phase E: Extended Features (2ì£¼ - Optional)

**ëª©í‘œ**: Extended Chunk Types, Snapshot Versioning, Advanced Hooks

#### Week 3: Extended Chunk Types

**Frameworkë³„ íŒ¨í„´ ì¸ì‹**

```python
# src/foundation/chunk/framework_patterns.py

from typing import Protocol
from ..ir.models import IRDocument, Node

class FrameworkPatternDetector(Protocol):
    """Frameworkë³„ íŠ¹ìˆ˜ chunk íƒì§€"""

    def detect_routes(self, ir_doc: IRDocument) -> list[Node]:
        """API route íƒì§€"""
        ...

    def detect_services(self, ir_doc: IRDocument) -> list[Node]:
        """Service layer íƒì§€"""
        ...

    def detect_repositories(self, ir_doc: IRDocument) -> list[Node]:
        """Repository/DAO íƒì§€"""
        ...

class DjangoPatternDetector:
    """Django framework íŒ¨í„´"""

    def detect_routes(self, ir_doc: IRDocument) -> list[Node]:
        # path(), re_path() í˜¸ì¶œ íƒì§€
        # urls.py íŒŒì¼ì—ì„œ URL pattern ì¶”ì¶œ
        ...

    def detect_services(self, ir_doc: IRDocument) -> list[Node]:
        # Service í´ë˜ìŠ¤ ì»¨ë²¤ì…˜ íƒì§€
        ...

class FastAPIPatternDetector:
    """FastAPI framework íŒ¨í„´"""

    def detect_routes(self, ir_doc: IRDocument) -> list[Node]:
        # @app.get, @app.post ë°ì½”ë ˆì´í„° íƒì§€
        ...

class NestJSPatternDetector:
    """NestJS framework íŒ¨í„´"""

    def detect_routes(self, ir_doc: IRDocument) -> list[Node]:
        # @Controller, @Get, @Post ë°ì½”ë ˆì´í„° íƒì§€
        ...
```

```python
# src/foundation/chunk/builder.py

class ChunkBuilder:
    # ...

    def _build_extended_chunks(
        self,
        class_chunks: list[Chunk],
        file_chunks: list[Chunk],
        graph_doc: GraphDocument,
        file_text: list[str],
    ) -> list[Chunk]:
        """
        Extended chunk types ìƒì„±.

        Framework íŒ¨í„´ íƒì§€ ê¸°ë°˜:
        - route: API ì—”ë“œí¬ì¸íŠ¸
        - service: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë ˆì´ì–´
        - repository: ë°ì´í„° ì ‘ê·¼ ë ˆì´ì–´
        - config: ì„¤ì • íŒŒì¼/í´ë˜ìŠ¤
        - job: ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…
        - middleware: ë¯¸ë“¤ì›¨ì–´
        """
        extended = []

        # 1. Route chunks
        if self._pattern_detector:
            route_nodes = self._pattern_detector.detect_routes(graph_doc)
            for node in route_nodes:
                chunk = self._create_route_chunk(node, file_text)
                extended.append(chunk)

        # 2. Service chunks
        # ...

        return extended
```

#### Week 4: Snapshot Versioning & Advanced Hooks

**Snapshot ë©€í‹° ë²„ì „ ì €ì¥**

```python
# migrations/003_chunk_versioning.sql

-- Option 1: Primary Key ë³€ê²½
ALTER TABLE chunks DROP CONSTRAINT chunks_pkey;
ALTER TABLE chunks ADD PRIMARY KEY (chunk_id, snapshot_id);

-- Option 2: ë³„ë„ ë²„ì „ í…Œì´ë¸” (ê¶Œì¥)
CREATE TABLE chunk_versions (
  chunk_id     TEXT NOT NULL,
  snapshot_id  TEXT NOT NULL,
  version      INTEGER NOT NULL,
  data         JSONB NOT NULL,
  created_at   TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  PRIMARY KEY (chunk_id, snapshot_id)
);

CREATE INDEX idx_chunk_versions_chunk
  ON chunk_versions(chunk_id);

CREATE INDEX idx_chunk_versions_snapshot
  ON chunk_versions(snapshot_id);
```

**Advanced Hooks**

```python
# src/foundation/chunk/hooks.py

class AdvancedChunkUpdateHook(ChunkUpdateHook):
    """ê³ ê¸‰ Hook: LLM ìš”ì•½, RepoMap ì—…ë°ì´íŠ¸, Index ì•Œë¦¼"""

    def __init__(
        self,
        llm_provider: LLMProvider,
        repomap_updater: RepoMapIncrementalUpdater,
        index_notifier: IndexNotifier,
    ):
        self.llm = llm_provider
        self.repomap = repomap_updater
        self.indexer = index_notifier

    def on_chunk_modified(self, chunk: Chunk) -> None:
        """Chunk ìˆ˜ì • ì‹œ: Summary ì¬ìƒì„± + Index ì•Œë¦¼"""
        # 1. LLM Summary ì¬ìƒì„± (ë¹„ë™ê¸°)
        if chunk.kind in ("function", "class"):
            summary = self.llm.summarize(chunk.content)
            chunk.summary = summary

        # 2. RepoMap ì—…ë°ì´íŠ¸ ì•Œë¦¼
        self.repomap.notify_chunk_modified(chunk.chunk_id)

        # 3. Index ì—…ë°ì´íŠ¸ ì•Œë¦¼
        self.indexer.notify_chunk_updated(chunk)

    def on_chunk_drifted(self, chunk: Chunk) -> None:
        """Span drift ì‹œ: Importance ì¬ê³„ì‚°"""
        # RepoMapì—ì„œ PageRank ì¬ê³„ì‚° íŠ¸ë¦¬ê±°
        self.repomap.notify_chunk_drifted(chunk.chunk_id)

    def on_chunk_renamed(self, old_id: str, new_chunk: Chunk) -> None:
        """Rename ì‹œ: ID ë§¤í•‘ ì—…ë°ì´íŠ¸"""
        # RepoMap, Indexì— rename ì•Œë¦¼
        self.repomap.notify_chunk_renamed(old_id, new_chunk.chunk_id)
        self.indexer.notify_chunk_renamed(old_id, new_chunk.chunk_id)
```

---

## 5. ì„¸ë¶€ êµ¬í˜„ í•­ëª© ì²´í¬ë¦¬ìŠ¤íŠ¸

### 5.1 Phase D ì²´í¬ë¦¬ìŠ¤íŠ¸ (Production Ready)

#### Week 1: DB & Store
- [ ] **DB Migration ìŠ¤í¬ë¦½íŠ¸**
  - [ ] migrations/002_create_chunk_tables.sql
  - [ ] Alembic migration ìŠ¤í¬ë¦½íŠ¸
  - [ ] chunks í…Œì´ë¸” + ì¸ë±ìŠ¤
  - [ ] chunk_hierarchy í…Œì´ë¸”
  - [ ] chunk_ir_map í…Œì´ë¸”
  - [ ] chunk_graph_map í…Œì´ë¸”

- [ ] **PostgresChunkStore êµ¬í˜„**
  - [ ] asyncpg Pool ì´ˆê¸°í™”
  - [ ] save_chunk (upsert)
  - [ ] get_chunk
  - [ ] find_chunks_by_repo
  - [ ] find_chunk_by_file_and_line (Zoekt ë§¤í•‘ìš©)
  - [ ] find_file_chunk (fallback)
  - [ ] delete_chunks_by_repo (soft delete)
  - [ ] _row_to_chunk ë³€í™˜
  - [ ] íŠ¸ëœì­ì…˜ ê´€ë¦¬

#### Week 2: Phase C & Testing
- [ ] **Phase C ì™„ì„±**
  - [ ] _handle_modified_file_partial êµ¬í˜„
  - [ ] _identify_affected_chunks êµ¬í˜„
  - [ ] use_partial_updates í”Œë˜ê·¸ ë™ì‘ ê²€ì¦
  - [ ] Fallback to full rebuild ë¡œì§

- [ ] **í†µí•© í…ŒìŠ¤íŠ¸**
  - [ ] PostgresChunkStore CRUD í…ŒìŠ¤íŠ¸
  - [ ] find_chunk_by_file_and_line ì •í™•ë„ í…ŒìŠ¤íŠ¸
  - [ ] Phase C end-to-end í…ŒìŠ¤íŠ¸
  - [ ] ëŒ€í˜• íŒŒì¼ ì¦ë¶„ ì—…ë°ì´íŠ¸ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
  - [ ] ë‹¤ì¤‘ íŒŒì¼ ë™ì‹œ ì¦ë¶„ í…ŒìŠ¤íŠ¸

- [ ] **ë¬¸ì„œí™”**
  - [ ] API ë¬¸ì„œ (ChunkStore, ChunkBuilder)
  - [ ] ì¦ë¶„ ì—…ë°ì´íŠ¸ ê°€ì´ë“œ
  - [ ] ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ê²°ê³¼

### 5.2 Phase E ì²´í¬ë¦¬ìŠ¤íŠ¸ (Extended Features - Optional)

#### Week 3: Extended Types
- [ ] **Framework íŒ¨í„´ íƒì§€**
  - [ ] FrameworkPatternDetector Protocol
  - [ ] DjangoPatternDetector
  - [ ] FastAPIPatternDetector
  - [ ] NestJSPatternDetector

- [ ] **Extended Chunk ë¹Œë”**
  - [ ] _create_route_chunk
  - [ ] _create_service_chunk
  - [ ] _create_repository_chunk
  - [ ] _create_config_chunk
  - [ ] _create_job_chunk
  - [ ] _create_middleware_chunk

#### Week 4: Versioning & Hooks
- [ ] **Snapshot Versioning**
  - [ ] chunk_versions í…Œì´ë¸”
  - [ ] Multi-version save/load
  - [ ] ê³¼ê±° snapshot ì¡°íšŒ API

- [ ] **Advanced Hooks**
  - [ ] AdvancedChunkUpdateHook êµ¬í˜„
  - [ ] LLM Summary ì¬ìƒì„± í†µí•©
  - [ ] RepoMap ì—…ë°ì´íŠ¸ ì•Œë¦¼
  - [ ] Index ì—…ë°ì´íŠ¸ ì•Œë¦¼

---

## 6. í…ŒìŠ¤íŠ¸ ì „ëµ

### 6.1 Unit Test ë²”ìœ„

**PostgresChunkStore**
- [ ] save_chunk (upsert) - ì‹ ê·œ/ìˆ˜ì • ëª¨ë‘ ë™ì‘
- [ ] get_chunk - ì¡´ì¬/ë¶€ì¬ ì¼€ì´ìŠ¤
- [ ] find_chunks_by_repo - snapshot í•„í„°ë§
- [ ] find_chunk_by_file_and_line - ìš°ì„ ìˆœìœ„ ì •ë ¬ (function > class > file)
- [ ] find_file_chunk - íŒŒì¼ ë ˆë²¨ ì¡°íšŒ
- [ ] delete_chunks_by_repo - soft delete

**Phase C (Diff-based)**
- [ ] _identify_affected_chunks - ë‹¤ì–‘í•œ overlap ì¼€ì´ìŠ¤
- [ ] _handle_modified_file_partial - ë¶€ë¶„ ì¬ìƒì„±
- [ ] Fallback to full rebuild - affected_chunk ì—†ì„ ë•Œ

### 6.2 Integration Test ì‹œë‚˜ë¦¬ì˜¤

**E2E í”Œë¡œìš°**
```python
def test_chunk_incremental_e2e_with_postgres():
    # 1. PostgresChunkStore ì´ˆê¸°í™”
    # 2. ì´ˆê¸° íŒŒì¼ ìƒì„± â†’ ChunkBuilder â†’ save
    # 3. íŒŒì¼ ìˆ˜ì • (diff ìƒì„±)
    # 4. ChunkIncrementalRefresher.refresh_files (use_partial_updates=True)
    # 5. ê²€ì¦:
    #    - affected_chunkë§Œ ì—…ë°ì´íŠ¸ë¨
    #    - unaffected_chunkëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€
    #    - DBì— ì •í™•íˆ ì €ì¥ë¨
```

**Zoekt ë§¤í•‘ í…ŒìŠ¤íŠ¸**
```python
def test_zoekt_chunk_mapping():
    # 1. ìƒ˜í”Œ ì½”ë“œ íŒŒì¼ ìƒì„± (í•¨ìˆ˜, í´ë˜ìŠ¤ í¬í•¨)
    # 2. ChunkBuilder â†’ ChunkStore
    # 3. find_chunk_by_file_and_line í˜¸ì¶œ (ë‹¤ì–‘í•œ line ë²ˆí˜¸)
    # 4. ê²€ì¦:
    #    - í•¨ìˆ˜ ë‚´ë¶€ line â†’ function chunk
    #    - í´ë˜ìŠ¤ ë‚´ë¶€ (í•¨ìˆ˜ ì™¸ë¶€) line â†’ class chunk
    #    - íŒŒì¼ ë ˆë²¨ line â†’ file chunk
    #    - ë§¤í•‘ ì‹¤íŒ¨ìœ¨ < 5%
```

**ì„±ëŠ¥ í…ŒìŠ¤íŠ¸**
```python
def test_incremental_performance():
    # 1. ëŒ€í˜• íŒŒì¼ (1000 lines, 100 functions)
    # 2. 10ì¤„ë§Œ ìˆ˜ì •
    # 3. ì¦ë¶„ ì—…ë°ì´íŠ¸ (use_partial_updates=True)
    # 4. ê²€ì¦:
    #    - ìˆ˜í–‰ ì‹œê°„ < 1ì´ˆ
    #    - affected_chunks <= 5ê°œ
    #    - DB ì¿¼ë¦¬ ìˆ˜ ìµœì†Œí™”
```

### 6.3 ì„±ëŠ¥ ëª©í‘œ

| ì§€í‘œ | ëª©í‘œ (Phase D) | ì¸¡ì • ë°©ë²• |
|------|---------------|----------|
| Chunk ìƒì„± (1000 lines) | < 2ì´ˆ | ChunkBuilder.build E2E |
| ì¦ë¶„ ì—…ë°ì´íŠ¸ (10 files) | < 5ì´ˆ | ChunkIncrementalRefresher.refresh_files |
| Partial update (1 file, 10 lines) | < 1ì´ˆ | use_partial_updates=True |
| find_chunk_by_file_and_line | < 50ms | PostgresChunkStore ë‹¨ì¼ ì¿¼ë¦¬ |
| Zoekt ë§¤í•‘ ì‹¤íŒ¨ìœ¨ | < 5% | (ë§¤í•‘ ì‹¤íŒ¨) / (ì´ ê²°ê³¼) |

---

## 7. ìœ„í—˜ ìš”ì†Œ ë° ì™„í™” ì „ëµ

### 7.1 High Risk

| ìœ„í—˜ | ì˜í–¥ | ì™„í™” ì „ëµ |
|------|------|----------|
| **PostgresChunkStore ì„±ëŠ¥** | High | - idx_chunks_file_span ì¸ë±ìŠ¤ ìµœì í™”<br>- Connection pool í¬ê¸° ì¡°ì •<br>- ì¿¼ë¦¬ ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ |
| **Phase C ë³µì¡ë„** | High | - ì¶©ë¶„í•œ unit test<br>- Fallback to full rebuild<br>- Logging/ëª¨ë‹ˆí„°ë§ ê°•í™” |
| **Span drift ì˜¤íƒ** | Medium | - SPAN_DRIFT_THRESHOLD íŠœë‹<br>- original_start_line ì •í™•ë„ ê²€ì¦<br>- Drift ì´ë²¤íŠ¸ ë¡œê¹… |

### 7.2 Medium Risk

| ìœ„í—˜ | ì˜í–¥ | ì™„í™” ì „ëµ |
|------|------|----------|
| **DB Migration ì‹¤íŒ¨** | Medium | - Alembic ê¸°ë°˜ ë²„ì „ ê´€ë¦¬<br>- ë¡¤ë°± ìŠ¤í¬ë¦½íŠ¸ ì¤€ë¹„<br>- Staging í™˜ê²½ í…ŒìŠ¤íŠ¸ |
| **Extended Chunk íŒ¨í„´ ì¸ì‹ ì •í™•ë„** | Medium | - Frameworkë³„ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤<br>- ì ì§„ì  í™•ì¥ (Django â†’ FastAPI â†’ NestJS)<br>- False positive í—ˆìš© ì •ì±… |
| **Snapshot ë²„ì „ ê´€ë¦¬ ë³µì¡ë„** | Low | - Phase Eì—ì„œ ì„ íƒì  êµ¬í˜„<br>- ë‹¨ìˆœ ë²„ì „ (chunk_versions í…Œì´ë¸”) ìš°ì„ <br>- ë³µì¡í•œ íƒ€ì„ë¨¸ì‹  ê²€ìƒ‰ì€ ë³´ë¥˜ |

---

## 8. ì°¸ì¡° ë¬¸ì„œ ë° ì½”ë“œ

### 8.1 ì„¤ê³„ ë¬¸ì„œ
- [ì‘ì—…ê³„íš](ì‘ì—…ê³„íš) - ì „ì²´ ì‹¤í–‰ ê³„íšì„œ
- [ìŠ¤í‚¤ë§ˆëŒ€ì‘](ìŠ¤í‚¤ë§ˆëŒ€ì‘) - DB ìŠ¤í‚¤ë§ˆ ì„¤ê³„
- [IMPLEMENTATION_STATUS.md](../../IMPLEMENTATION_STATUS.md) - ì „ì²´ êµ¬í˜„ ìƒíƒœ

### 8.2 í˜„ì¬ êµ¬í˜„
- [src/foundation/chunk/models.py](../../src/foundation/chunk/models.py) - Chunk ëª¨ë¸
- [src/foundation/chunk/builder.py](../../src/foundation/chunk/builder.py) - ChunkBuilder
- [src/foundation/chunk/incremental.py](../../src/foundation/chunk/incremental.py) - Phase A/B ì™„ë£Œ, C ì§„í–‰ ì¤‘
- [src/foundation/chunk/store.py](../../src/foundation/chunk/store.py) - ChunkStore (InMemory ì™„ë£Œ, Postgres TODO)
- [tests/foundation/test_chunk_*.py](../../tests/foundation/) - í…ŒìŠ¤íŠ¸

### 8.3 êµ¬í˜„ ëŒ€ìƒ
- [migrations/002_create_chunk_tables.sql](../../migrations/) - DB Migration
- [src/foundation/chunk/store.py](../../src/foundation/chunk/store.py) - PostgresChunkStore êµ¬í˜„
- [src/foundation/chunk/incremental.py](../../src/foundation/chunk/incremental.py) - Phase C ì™„ì„±
- [src/foundation/chunk/framework_patterns.py](../../src/foundation/chunk/) - Extended Chunk íŒ¨í„´ íƒì§€

---

## 9. ë‹¤ìŒ ë‹¨ê³„ (Immediate Actions)

### 9.1 ë‹¨ê¸° (ì´ë²ˆ ì£¼)
1. **DB Migration ìŠ¤í¬ë¦½íŠ¸** (1ì¼)
   - migrations/002_create_chunk_tables.sql ì‘ì„±
   - Alembic migration ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
   - ë¡œì»¬ DBì—ì„œ í…ŒìŠ¤íŠ¸

2. **PostgresChunkStore êµ¬í˜„** (2ì¼)
   - asyncpg Pool ì´ˆê¸°í™”
   - CRUD ë©”ì„œë“œ êµ¬í˜„
   - find_chunk_by_file_and_line êµ¬í˜„

3. **Unit Test** (1ì¼)
   - PostgresChunkStore ì „ì²´ ë©”ì„œë“œ í…ŒìŠ¤íŠ¸
   - ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬

### 9.2 ì¤‘ê¸° (ë‹¤ìŒ ì£¼)
4. **Phase C ì™„ì„±** (2ì¼)
   - _identify_affected_chunks êµ¬í˜„
   - _handle_modified_file_partial êµ¬í˜„
   - end-to-end í…ŒìŠ¤íŠ¸

5. **í†µí•© í…ŒìŠ¤íŠ¸** (1ì¼)
   - Zoekt ë§¤í•‘ í…ŒìŠ¤íŠ¸
   - ëŒ€í˜• íŒŒì¼ ì¦ë¶„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸
   - ì„±ëŠ¥ ê²€ì¦

6. **ë¬¸ì„œí™”** (1ì¼)
   - API ë¬¸ì„œ
   - ì¦ë¶„ ì—…ë°ì´íŠ¸ ê°€ì´ë“œ

### 9.3 ì¥ê¸° (Phase E - Optional)
7. **Extended Chunk Types** (1ì£¼)
   - Framework íŒ¨í„´ íƒì§€
   - route/service/repository ë¹Œë”

8. **Snapshot Versioning** (1ì£¼)
   - chunk_versions í…Œì´ë¸”
   - Multi-version ê´€ë¦¬

---

## 10. ìš”ì•½

**í˜„ì¬ ì™„ì„±ë„**:
- Phase A (ê¸°ë³¸ ì¦ë¶„): 100% âœ…
- Phase B (Span Drift & Rename): 100% âœ…
- Phase C (Diff-based Partial): 60% ğŸ”„
- PostgresChunkStore: 0% âŒ
- **ì „ì²´: ì•½ 75%**

**Production Ready ê¸°ì¤€** (Phase D ì™„ë£Œ):
- PostgresChunkStore ì™„ì„±
- Phase C ì™„ì„±
- DB Migration ì™„ë£Œ
- í†µí•© í…ŒìŠ¤íŠ¸ í†µê³¼
- ì„±ëŠ¥ ëª©í‘œ ë‹¬ì„±

**Extended Features** (Phase E - Optional):
- Extended Chunk Types (route/service/repository)
- Snapshot Versioning (íƒ€ì„ë¨¸ì‹  ê²€ìƒ‰)
- Advanced Hooks (LLM Summary, RepoMap/Index ì•Œë¦¼)

**ìµœìš°ì„  ì‘ì—…**:
1. DB Migration ìŠ¤í¬ë¦½íŠ¸ (1ì¼)
2. PostgresChunkStore êµ¬í˜„ (2ì¼)
3. Phase C ì™„ì„± (2ì¼)
4. í†µí•© í…ŒìŠ¤íŠ¸ (1ì¼)
