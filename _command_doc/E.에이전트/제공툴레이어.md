1. íˆ´ ì¹´í…Œê³ ë¦¬ ì¬êµ¬ì„±
Tool Layer
â”œâ”€â”€ ğŸ” Discovery Tools (ì½”ë“œ íƒìƒ‰)
â”‚   â”œâ”€â”€ code_search
â”‚   â”œâ”€â”€ symbol_search  
â”‚   â”œâ”€â”€ find_usages
â”‚   â”œâ”€â”€ search_similar_code
â”‚   â””â”€â”€ file_tree
â”‚
â”œâ”€â”€ ğŸ“– Reading Tools (ì½”ë“œ ì½ê¸°)
â”‚   â”œâ”€â”€ open_file
â”‚   â”œâ”€â”€ get_span
â”‚   â”œâ”€â”€ get_symbol_definition
â”‚   â”œâ”€â”€ get_type_info
â”‚   â””â”€â”€ get_docstring
â”‚
â”œâ”€â”€ ğŸ•¸ï¸ Graph Tools (ê´€ê³„ ë¶„ì„)
â”‚   â”œâ”€â”€ get_callers
â”‚   â”œâ”€â”€ get_callees
â”‚   â”œâ”€â”€ get_dependencies
â”‚   â”œâ”€â”€ get_dependents
â”‚   â””â”€â”€ get_inheritance_tree
â”‚
â”œâ”€â”€ âœï¸ Mutation Tools (ì½”ë“œ ìˆ˜ì •)
â”‚   â”œâ”€â”€ propose_patch
â”‚   â”œâ”€â”€ apply_patch
â”‚   â”œâ”€â”€ create_file
â”‚   â”œâ”€â”€ delete_file
â”‚   â””â”€â”€ rename_symbol
â”‚
â”œâ”€â”€ âœ… Validation Tools (ê²€ì¦)
â”‚   â”œâ”€â”€ run_tests
â”‚   â”œâ”€â”€ run_single_test
â”‚   â”œâ”€â”€ run_lint
â”‚   â”œâ”€â”€ check_syntax
â”‚   â””â”€â”€ type_check
â”‚
â”œâ”€â”€ ğŸ“œ History Tools (ì´ë ¥)
â”‚   â”œâ”€â”€ git_diff
â”‚   â”œâ”€â”€ git_blame
â”‚   â”œâ”€â”€ git_log
â”‚   â””â”€â”€ get_recent_changes
â”‚
â””â”€â”€ ğŸ§  Analysis Tools (ë¶„ì„)
    â”œâ”€â”€ explain_error
    â”œâ”€â”€ analyze_complexity
    â”œâ”€â”€ detect_code_smells
    â””â”€â”€ summarize_file

2. í‘œì¤€ Tool Contract (JSON Schema)
ëª¨ë“  íˆ´ì´ ì§€ì¼œì•¼ í•  ì…ì¶œë ¥ ê·œê²©:
typescript// ê³µí†µ ìš”ì²­ êµ¬ì¡°
interface ToolRequest<T> {
  tool_name: string;
  params: T;
  request_id: string;
  context?: {
    session_id: string;
    parent_request_id?: string;  // ì²´ì´ë‹ ì¶”ì 
  };
}

// ê³µí†µ ì‘ë‹µ êµ¬ì¡°
interface ToolResponse<T> {
  success: boolean;
  data?: T;
  error?: ToolError;
  metadata: {
    execution_time_ms: number;
    tokens_used?: number;        // context ì˜ˆì‚° ê´€ë¦¬
    truncated: boolean;          // ê²°ê³¼ ì˜ë¦¼ ì—¬ë¶€
    confidence?: number;         // 0-1, ê²€ìƒ‰ ê²°ê³¼ ì‹ ë¢°ë„
    cache_hit: boolean;
  };
  suggestions?: string[];        // ë‹¤ìŒ ì¶”ì²œ ì•¡ì…˜
}

// í‘œì¤€ ì—ëŸ¬ íƒ€ì…
interface ToolError {
  code: ErrorCode;
  message: string;
  recoverable: boolean;          // ì¬ì‹œë„ ê°€ëŠ¥ ì—¬ë¶€
  retry_hint?: string;           // ì–´ë–»ê²Œ ì¬ì‹œë„í• ì§€
}

enum ErrorCode {
  NOT_FOUND = "NOT_FOUND",
  INVALID_PARAMS = "INVALID_PARAMS",
  TIMEOUT = "TIMEOUT",
  RATE_LIMITED = "RATE_LIMITED",
  PARSE_ERROR = "PARSE_ERROR",
  PERMISSION_DENIED = "PERMISSION_DENIED",
  CONFLICT = "CONFLICT",          // patch ì¶©ëŒ
  TOO_LARGE = "TOO_LARGE",        // ê²°ê³¼ê°€ ë„ˆë¬´ í¼
}

3. í•µì‹¬ íˆ´ ìƒì„¸ ìŠ¤í™
3-1. Discovery Tools
typescript// code_search: ìì—°ì–´ + ì½”ë“œ íŒ¨í„´ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰
interface CodeSearchParams {
  query: string;
  scope?: {
    paths?: string[];           // íŠ¹ì • ë””ë ‰í† ë¦¬ë§Œ
    extensions?: string[];      // [".py", ".ts"]
    exclude?: string[];         // ["test_*", "*_mock*"]
  };
  search_type?: "semantic" | "literal" | "regex" | "hybrid";
  max_results?: number;         // default 10
  include_context?: boolean;    // ì£¼ë³€ ì½”ë“œ í¬í•¨
  context_lines?: number;       // ì•ë’¤ ëª‡ ì¤„
}

interface CodeSearchResult {
  matches: Array<{
    file_path: string;
    line_start: number;
    line_end: number;
    content: string;
    context_before?: string;
    context_after?: string;
    score: number;              // ê´€ë ¨ë„ 0-1
    match_type: "exact" | "semantic" | "fuzzy";
  }>;
  total_matches: number;        // ì „ì²´ ê°œìˆ˜ (í˜ì´ì§•ìš©)
  search_stats: {
    files_scanned: number;
    time_ms: number;
  };
}

// symbol_search: ì‹¬ë³¼ ì •ì˜ ê²€ìƒ‰
interface SymbolSearchParams {
  name: string;
  kind?: SymbolKind[];          // ["function", "class", "variable"]
  scope?: string[];             // íŒŒì¼/ë””ë ‰í† ë¦¬ ì œí•œ
  exact_match?: boolean;        // falseë©´ fuzzy
}

enum SymbolKind {
  FUNCTION = "function",
  CLASS = "class", 
  METHOD = "method",
  VARIABLE = "variable",
  CONSTANT = "constant",
  INTERFACE = "interface",
  TYPE = "type",
  MODULE = "module",
}

interface SymbolSearchResult {
  symbols: Array<{
    name: string;
    kind: SymbolKind;
    file_path: string;
    line_start: number;
    line_end: number;
    signature?: string;         // í•¨ìˆ˜ë©´ ì‹œê·¸ë‹ˆì²˜
    docstring?: string;
    exported: boolean;          // public ì—¬ë¶€
    parent?: string;            // ì†Œì† í´ë˜ìŠ¤/ëª¨ë“ˆ
  }>;
}

// find_usages: ì‹¬ë³¼ ì‚¬ìš©ì²˜ ì „ì²´ íƒìƒ‰
interface FindUsagesParams {
  symbol_name: string;
  definition_path?: string;     // ì •ì˜ ìœ„ì¹˜ (ë™ëª…ì´ì˜ êµ¬ë¶„)
  include_definitions?: boolean;
  include_imports?: boolean;
  group_by?: "file" | "type";   // ê·¸ë£¹í•‘ ë°©ì‹
}

interface FindUsagesResult {
  definition: SymbolLocation;
  usages: Array<{
    file_path: string;
    line: number;
    column: number;
    usage_type: "call" | "reference" | "import" | "type_annotation";
    context_snippet: string;
  }>;
  usage_count: number;
  files_affected: string[];
}

// search_similar_code: ìœ ì‚¬ ì½”ë“œ íŒ¨í„´ ê²€ìƒ‰
interface SearchSimilarParams {
  code_snippet: string;
  min_similarity?: number;      // 0-1, default 0.7
  max_results?: number;
  scope?: string[];
}

interface SearchSimilarResult {
  matches: Array<{
    file_path: string;
    line_start: number;
    line_end: number;
    content: string;
    similarity_score: number;
    diff_highlights?: string[]; // ë‹¤ë¥¸ ë¶€ë¶„ í‘œì‹œ
  }>;
}
3-2. Reading Tools
typescript// open_file: íŒŒì¼ ì½ê¸° (ìŠ¤ë§ˆíŠ¸ ì²­í‚¹)
interface OpenFileParams {
  path: string;
  range?: {
    start_line?: number;
    end_line?: number;
  };
  // ìƒˆë¡œìš´ ì˜µì…˜ë“¤
  max_lines?: number;           // ë„ˆë¬´ ê¸¸ë©´ ìë™ truncate
  focus_symbol?: string;        // íŠ¹ì • ì‹¬ë³¼ ì¤‘ì‹¬ìœ¼ë¡œ í™•ì¥
  include_imports?: boolean;    // import êµ¬ë¬¸ í¬í•¨
  include_metadata?: boolean;   // íŒŒì¼ ë©”íƒ€ ì •ë³´
}

interface OpenFileResult {
  content: string;
  total_lines: number;
  returned_range: { start: number; end: number };
  truncated: boolean;
  language: string;
  metadata?: {
    size_bytes: number;
    last_modified: string;
    encoding: string;
  };
  symbols_in_range?: SymbolInfo[];  // ë²”ìœ„ ë‚´ ì‹¬ë³¼ë“¤
}

// get_type_info: íƒ€ì… ì •ë³´ ì¡°íšŒ
interface GetTypeInfoParams {
  symbol_name: string;
  file_path: string;
  line?: number;
  column?: number;
}

interface GetTypeInfoResult {
  symbol: string;
  type_string: string;          // "def foo(x: int) -> str"
  inferred: boolean;            // ì¶”ë¡ ëœ íƒ€ì…ì¸ì§€
  generic_params?: string[];
  return_type?: string;
  param_types?: Array<{ name: string; type: string; optional: boolean }>;
  related_types?: string[];     // ì—°ê´€ íƒ€ì… ì •ì˜
}

// get_symbol_definition: ì‹¬ë³¼ ì „ì²´ ì •ì˜ ê°€ì ¸ì˜¤ê¸°
interface GetSymbolDefinitionParams {
  symbol_name: string;
  file_path?: string;           // íŒíŠ¸
  include_decorators?: boolean;
  include_docstring?: boolean;
  include_body?: boolean;       // falseë©´ ì‹œê·¸ë‹ˆì²˜ë§Œ
}

interface GetSymbolDefinitionResult {
  definition: {
    full_text: string;
    signature: string;
    docstring?: string;
    decorators?: string[];
    body?: string;
  };
  location: SymbolLocation;
  complexity?: {
    cyclomatic: number;
    cognitive: number;
    lines: number;
  };
}
3-3. Graph Tools (Semantica ê°•ì )
typescript// get_callers: ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê³³ë“¤
interface GetCallersParams {
  symbol_name: string;
  file_path?: string;
  depth?: number;               // 1 = ì§ì ‘ í˜¸ì¶œë§Œ, 2+ = ì¬ê·€ì 
  max_results?: number;
  include_test_files?: boolean; // í…ŒìŠ¤íŠ¸ ì½”ë“œ í¬í•¨ ì—¬ë¶€
}

interface GetCallersResult {
  callers: Array<{
    caller_name: string;
    caller_file: string;
    caller_line: number;
    call_site_snippet: string;
    depth: number;              // ëª‡ ë‹¨ê³„ ê±°ì³ì„œ í˜¸ì¶œ
    is_test: boolean;
  }>;
  call_graph_summary?: {
    total_callers: number;
    entry_points: string[];     // ìµœìƒìœ„ í˜¸ì¶œì
  };
}

// get_callees: ì´ í•¨ìˆ˜ê°€ í˜¸ì¶œí•˜ëŠ” ê²ƒë“¤
interface GetCalleesParams {
  symbol_name: string;
  file_path?: string;
  depth?: number;
  include_stdlib?: boolean;     // í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ í¬í•¨
  include_external?: boolean;   // ì™¸ë¶€ íŒ¨í‚¤ì§€ í¬í•¨
}

interface GetCalleesResult {
  callees: Array<{
    callee_name: string;
    callee_file?: string;       // ì™¸ë¶€ë©´ null
    call_line: number;
    is_internal: boolean;
    is_stdlib: boolean;
    depth: number;
  }>;
  dependency_tree?: DependencyNode;  // íŠ¸ë¦¬ êµ¬ì¡°
}

// get_dependencies: íŒŒì¼/ëª¨ë“ˆ ì˜ì¡´ì„±
interface GetDependenciesParams {
  path: string;                 // íŒŒì¼ or ë””ë ‰í† ë¦¬
  direction: "imports" | "imported_by" | "both";
  depth?: number;
  include_external?: boolean;
}

interface GetDependenciesResult {
  imports: Array<{
    module_name: string;
    import_path: string;
    is_internal: boolean;
    imported_symbols?: string[];
  }>;
  imported_by?: Array<{
    file_path: string;
    imported_symbols: string[];
  }>;
  circular_dependencies?: string[][];  // ìˆœí™˜ ì˜ì¡´ì„± ê²½ê³ 
}

// get_inheritance_tree: í´ë˜ìŠ¤ ìƒì† êµ¬ì¡°
interface GetInheritanceParams {
  class_name: string;
  file_path?: string;
  direction: "parents" | "children" | "both";
  depth?: number;
}

interface GetInheritanceResult {
  target_class: string;
  parents: Array<{
    name: string;
    file_path?: string;
    depth: number;
  }>;
  children: Array<{
    name: string;
    file_path: string;
    depth: number;
  }>;
  mro?: string[];               // Method Resolution Order
}
3-4. Mutation Tools
typescript// propose_patch: ìˆ˜ì • ì œì•ˆ (dry-run)
interface ProposePatchParams {
  file_path: string;
  changes: Array<{
    type: "replace" | "insert" | "delete";
    start_line: number;
    end_line?: number;          // delete/replaceìš©
    new_content?: string;       // insert/replaceìš©
    description?: string;       // ì´ ë³€ê²½ì˜ ì˜ë„
  }>;
  validate?: boolean;           // ë¬¸ë²• ê²€ì‚¬ ìˆ˜í–‰
}

interface ProposePatchResult {
  patch_id: string;             // ë‚˜ì¤‘ì— applyí•  ë•Œ ì‚¬ìš©
  unified_diff: string;         // git diff í˜•ì‹
  preview: {
    before: string;
    after: string;
  };
  validation?: {
    syntax_valid: boolean;
    type_check_passed?: boolean;
    lint_issues?: LintIssue[];
  };
  impact_analysis?: {
    affected_symbols: string[];
    affected_tests: string[];
    breaking_change_risk: "low" | "medium" | "high";
  };
}

// apply_patch: ì‹¤ì œ ì ìš©
interface ApplyPatchParams {
  patch_id: string;
  create_backup?: boolean;
  run_format?: boolean;         // í¬ë§¤í„° ì‹¤í–‰
}

interface ApplyPatchResult {
  success: boolean;
  file_path: string;
  backup_path?: string;
  formatted: boolean;
  post_apply_check?: {
    syntax_valid: boolean;
    tests_affected: string[];
  };
}

// rename_symbol: ì‹¬ë³¼ ì´ë¦„ ë³€ê²½ (ëª¨ë“  ì‚¬ìš©ì²˜)
interface RenameSymbolParams {
  old_name: string;
  new_name: string;
  file_path?: string;           // íŠ¹ì • ì •ì˜ë§Œ
  scope?: "file" | "project";
  preview_only?: boolean;
}

interface RenameSymbolResult {
  changes: Array<{
    file_path: string;
    line: number;
    old_text: string;
    new_text: string;
  }>;
  total_occurrences: number;
  files_affected: string[];
  warnings?: string[];          // ì´ë¦„ ì¶©ëŒ ë“±
}
3-5. Validation Tools
typescript// run_tests: í…ŒìŠ¤íŠ¸ ì‹¤í–‰
interface RunTestsParams {
  scope: "all" | "affected" | "specific";
  test_paths?: string[];        // specificì¼ ë•Œ
  affected_by?: string[];       // affectedì¼ ë•Œ: ë³€ê²½ëœ íŒŒì¼ë“¤
  timeout_seconds?: number;
  parallel?: boolean;
  coverage?: boolean;
}

interface RunTestsResult {
  summary: {
    total: number;
    passed: number;
    failed: number;
    skipped: number;
    duration_ms: number;
  };
  failed_tests: Array<{
    test_name: string;
    file_path: string;
    error_message: string;
    stack_trace?: string;
    failure_type: "assertion" | "error" | "timeout";
  }>;
  coverage?: {
    line_coverage: number;
    branch_coverage: number;
    uncovered_lines?: Array<{ file: string; lines: number[] }>;
  };
}

// run_single_test: ë‹¨ì¼ í…ŒìŠ¤íŠ¸ (ë¹ ë¥¸ í”¼ë“œë°±)
interface RunSingleTestParams {
  test_identifier: string;      // "test_file.py::test_function"
  timeout_seconds?: number;
  capture_output?: boolean;
}

interface RunSingleTestResult {
  passed: boolean;
  duration_ms: number;
  output?: string;
  error?: {
    message: string;
    stack_trace: string;
    locals?: Record<string, string>;  // ì‹¤íŒ¨ ì‹œì  ë³€ìˆ˜ê°’
  };
}

// check_syntax: ë¬¸ë²• ê²€ì‚¬ë§Œ (ë¹ ë¦„)
interface CheckSyntaxParams {
  file_path?: string;
  content?: string;             // íŒŒì¼ ì—†ì´ ì§ì ‘ ê²€ì‚¬
  language?: string;
}

interface CheckSyntaxResult {
  valid: boolean;
  errors: Array<{
    line: number;
    column: number;
    message: string;
    severity: "error" | "warning";
  }>;
}

// type_check: íƒ€ì… ê²€ì‚¬
interface TypeCheckParams {
  paths?: string[];             // ë¹„ì–´ìˆìœ¼ë©´ ì „ì²´
  strict?: boolean;
}

interface TypeCheckResult {
  success: boolean;
  errors: Array<{
    file_path: string;
    line: number;
    column: number;
    message: string;
    error_code: string;
    suggested_fix?: string;
  }>;
  stats: {
    files_checked: number;
    errors_found: number;
  };
}
3-6. History Tools
typescript// git_blame: ë¼ì¸ë³„ ìˆ˜ì • ì´ë ¥
interface GitBlameParams {
  file_path: string;
  line_range?: { start: number; end: number };
}

interface GitBlameResult {
  lines: Array<{
    line_number: number;
    commit_hash: string;
    author: string;
    date: string;
    commit_message: string;
    content: string;
  }>;
  summary: {
    authors: Array<{ name: string; lines: number }>;
    oldest_line: { date: string; commit: string };
    newest_line: { date: string; commit: string };
  };
}

// git_log: íŒŒì¼/ì‹¬ë³¼ ë³€ê²½ ì´ë ¥
interface GitLogParams {
  path?: string;
  symbol?: string;              // íŠ¹ì • ì‹¬ë³¼ ë³€ê²½ ì´ë ¥
  max_commits?: number;
  since?: string;               // "2024-01-01" or "30 days ago"
}

interface GitLogResult {
  commits: Array<{
    hash: string;
    author: string;
    date: string;
    message: string;
    files_changed: string[];
    insertions: number;
    deletions: number;
  }>;
}

// get_recent_changes: ìµœê·¼ ë³€ê²½ ìš”ì•½
interface GetRecentChangesParams {
  since?: string;
  paths?: string[];
  authors?: string[];
}

interface GetRecentChangesResult {
  changes: Array<{
    file_path: string;
    change_type: "added" | "modified" | "deleted" | "renamed";
    commit_hash: string;
    author: string;
    date: string;
    summary: string;
  }>;
  stats: {
    files_added: number;
    files_modified: number;
    files_deleted: number;
    total_insertions: number;
    total_deletions: number;
  };
}
3-7. Analysis Tools
typescript// explain_error: ì—ëŸ¬ ë©”ì‹œì§€ í•´ì„
interface ExplainErrorParams {
  error_message: string;
  stack_trace?: string;
  context?: {
    file_path?: string;
    language?: string;
    framework?: string;
  };
}

interface ExplainErrorResult {
  explanation: string;
  error_type: string;
  probable_causes: Array<{
    cause: string;
    likelihood: number;         // 0-1
    evidence?: string;
  }>;
  suggested_fixes: Array<{
    description: string;
    code_hint?: string;
    confidence: number;
  }>;
  related_symbols?: string[];   // ê´€ë ¨ëœ ì‹¬ë³¼ë“¤
  documentation_links?: string[];
}

// analyze_complexity: ë³µì¡ë„ ë¶„ì„
interface AnalyzeComplexityParams {
  path: string;                 // íŒŒì¼ or ë””ë ‰í† ë¦¬
  threshold?: {
    cyclomatic?: number;
    cognitive?: number;
    lines?: number;
  };
}

interface AnalyzeComplexityResult {
  files: Array<{
    path: string;
    symbols: Array<{
      name: string;
      kind: SymbolKind;
      metrics: {
        cyclomatic: number;
        cognitive: number;
        lines: number;
        params: number;
        nesting_depth: number;
      };
      exceeds_threshold: boolean;
    }>;
  }>;
  hotspots: string[];           // ê°€ì¥ ë³µì¡í•œ ì‹¬ë³¼ë“¤
  recommendations?: string[];
}

// detect_code_smells: ì½”ë“œ ëƒ„ìƒˆ íƒì§€
interface DetectCodeSmellsParams {
  path: string;
  smell_types?: CodeSmellType[];
}

enum CodeSmellType {
  LONG_METHOD = "long_method",
  LARGE_CLASS = "large_class",
  DUPLICATE_CODE = "duplicate_code",
  DEAD_CODE = "dead_code",
  DEEP_NESTING = "deep_nesting",
  GOD_OBJECT = "god_object",
  FEATURE_ENVY = "feature_envy",
}

interface DetectCodeSmellsResult {
  smells: Array<{
    type: CodeSmellType;
    location: SymbolLocation;
    severity: "low" | "medium" | "high";
    description: string;
    suggested_refactoring?: string;
  }>;
  summary: Record<CodeSmellType, number>;
}

// summarize_file: íŒŒì¼ ìš”ì•½
interface SummarizeFileParams {
  path: string;
  detail_level?: "brief" | "detailed";
  include_examples?: boolean;
}

interface SummarizeFileResult {
  summary: string;
  purpose: string;
  main_components: Array<{
    name: string;
    kind: SymbolKind;
    description: string;
  }>;
  dependencies: string[];
  dependents: string[];
  key_patterns?: string[];      // ì‚¬ìš©ëœ ë””ìì¸ íŒ¨í„´
  test_coverage?: number;
}

4. íˆ´ ì‹¤í–‰ ì—”ì§„ ì„¤ê³„
typescriptclass ToolExecutor {
  private tools: Map<string, Tool>;
  private cache: ToolCache;
  private rateLimiter: RateLimiter;
  private metrics: MetricsCollector;

  async execute<T, R>(request: ToolRequest<T>): Promise<ToolResponse<R>> {
    const startTime = Date.now();
    
    // 1. ìºì‹œ í™•ì¸
    const cacheKey = this.getCacheKey(request);
    const cached = await this.cache.get(cacheKey);
    if (cached) {
      return { ...cached, metadata: { ...cached.metadata, cache_hit: true } };
    }

    // 2. Rate limit í™•ì¸
    await this.rateLimiter.acquire(request.tool_name);

    // 3. ì‹¤í–‰
    try {
      const tool = this.tools.get(request.tool_name);
      if (!tool) {
        return this.errorResponse("NOT_FOUND", `Tool ${request.tool_name} not found`);
      }

      const result = await tool.execute(request.params);
      
      // 4. ê²°ê³¼ í›„ì²˜ë¦¬
      const response = this.buildResponse(result, startTime);
      
      // 5. ìºì‹œ ì €ì¥ (mutation íˆ´ ì œì™¸)
      if (!tool.isMutation) {
        await this.cache.set(cacheKey, response);
      }

      // 6. ë©”íŠ¸ë¦­ ê¸°ë¡
      this.metrics.record(request.tool_name, response);

      return response;
    } catch (error) {
      return this.handleError(error, request);
    }
  }

  // ë°°ì¹˜ ì‹¤í–‰ (ë³‘ë ¬)
  async executeBatch<T, R>(
    requests: ToolRequest<T>[],
    options?: { maxConcurrent?: number }
  ): Promise<ToolResponse<R>[]> {
    const limit = pLimit(options?.maxConcurrent ?? 5);
    return Promise.all(
      requests.map(req => limit(() => this.execute(req)))
    );
  }
}

5. ìºì‹± ì „ëµ
typescriptinterface CacheConfig {
  // íˆ´ë³„ TTL
  ttl: {
    code_search: 300,           // 5ë¶„
    symbol_search: 600,         // 10ë¶„
    open_file: 60,              // 1ë¶„ (íŒŒì¼ ë³€ê²½ ê°ì§€)
    get_callers: 600,
    get_callees: 600,
    git_blame: 3600,            // 1ì‹œê°„
    // mutation íˆ´ì€ ìºì‹œ ì•ˆ í•¨
  };
  
  // ìºì‹œ ë¬´íš¨í™” íŠ¸ë¦¬ê±°
  invalidation: {
    on_file_change: ["open_file", "code_search", "symbol_search"],
    on_git_commit: ["git_blame", "git_log", "get_recent_changes"],
    on_patch_apply: ["*"],      // ì „ì²´ ë¬´íš¨í™”
  };
}

6. ì—ëŸ¬ ë³µêµ¬ ì „ëµ
typescriptconst errorRecoveryStrategies: Record<ErrorCode, RecoveryStrategy> = {
  NOT_FOUND: {
    recoverable: true,
    action: "suggest_alternatives",
    hint: "íŒŒì¼/ì‹¬ë³¼ ì´ë¦„ì„ ë‹¤ì‹œ í™•ì¸í•˜ê±°ë‚˜ code_searchë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”"
  },
  TIMEOUT: {
    recoverable: true,
    action: "retry_with_smaller_scope",
    hint: "ë²”ìœ„ë¥¼ ì¢í˜€ì„œ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”"
  },
  TOO_LARGE: {
    recoverable: true,
    action: "paginate_or_filter",
    hint: "max_resultsë¥¼ ì¤„ì´ê±°ë‚˜ scopeë¥¼ ì§€ì •í•˜ì„¸ìš”"
  },
  PARSE_ERROR: {
    recoverable: true,
    action: "check_syntax_first",
    hint: "íŒŒì¼ ë¬¸ë²• ì˜¤ë¥˜ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤"
  },
  CONFLICT: {
    recoverable: false,
    action: "manual_resolution",
    hint: "íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œë“œ í›„ ì‹œë„í•˜ì„¸ìš”"
  },
};

ì´ ì •ë„ë©´ Tool Layer ê¸°ë°˜ì´ íƒ„íƒ„í•´ì§‘ë‹ˆë‹¤